<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PERC - Administration</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 260px;
        background: linear-gradient(180deg, #2c3e50, #34495e);
        color: white;
        padding: 20px 0;
        overflow-y: auto;
        z-index: 1000;
        transition: all 0.3s;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .sidebar-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
        font-weight: 700;
      }

      .sidebar-logo i {
        font-size: 2rem;
      }

      .sidebar-menu {
        list-style: none;
        padding: 0;
      }

      .sidebar-menu li {
        margin: 5px 0;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .sidebar-menu i {
        font-size: 1.2rem;
        width: 24px;
      }

      /* Main content */
      .main-content {
        margin-left: 260px;
        padding: 20px;
        min-height: 100vh;
      }

      /* Navbar */
      .navbar-custom {
        background: white;
        padding: 15px 30px;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .navbar-title h4 {
        margin: 0;
        color: #2c3e50;
      }

      .navbar-user {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-info {
        text-align: right;
      }

      .user-name {
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
      }

      .user-role {
        font-size: 0.85rem;
        color: #7f8c8d;
        margin: 0;
      }

      /* Cards */
      .card-custom {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }

      .card-header-custom {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 20px;
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
      }

      /* Stats cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-left: 4px solid;
      }

      .stat-card.primary {
        border-color: #3498db;
      }
      .stat-card.success {
        border-color: #27ae60;
      }
      .stat-card.warning {
        border-color: #f39c12;
      }
      .stat-card.danger {
        border-color: #e74c3c;
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 15px;
      }

      .stat-card.primary .stat-icon {
        background: rgba(52, 152, 219, 0.1);
        color: #3498db;
      }
      .stat-card.success .stat-icon {
        background: rgba(39, 174, 96, 0.1);
        color: #27ae60;
      }
      .stat-card.warning .stat-icon {
        background: rgba(243, 156, 18, 0.1);
        color: #f39c12;
      }
      .stat-card.danger .stat-icon {
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
        margin: 10px 0 5px;
      }

      .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
      }

      /* Upload zone */
      .upload-zone {
        border: 3px dashed #3498db;
        border-radius: 15px;
        padding: 60px 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #f8f9fa;
      }

      .upload-zone:hover {
        border-color: #2980b9;
        background: #e3f2fd;
      }

      .upload-zone.dragover {
        border-color: #27ae60;
        background: #d4edda;
      }

      .upload-icon {
        font-size: 4rem;
        color: #3498db;
        margin-bottom: 20px;
      }

      .upload-text {
        font-size: 1.2rem;
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .upload-hint {
        color: #7f8c8d;
        font-size: 0.9rem;
      }

      /* Progress bar */
      .progress-custom {
        height: 30px;
        border-radius: 15px;
        background: #e0e0e0;
        overflow: hidden;
        margin: 20px 0;
      }

      .progress-bar-custom {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      /* Results */
      .result-box {
        background: #f8f9fa;
        border-left: 4px solid #3498db;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .result-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        text-align: center;
        margin-top: 20px;
      }

      .result-stat h3 {
        font-size: 2rem;
        margin: 0;
      }

      .result-stat p {
        color: #7f8c8d;
        margin: 5px 0 0;
      }

      .result-stat.success h3 {
        color: #27ae60;
      }
      .result-stat.error h3 {
        color: #e74c3c;
      }

      /* Table */
      .table-custom {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 10px;
      }

      .table-custom thead th {
        background: #f8f9fa;
        color: #2c3e50;
        font-weight: 600;
        padding: 15px;
        text-align: left;
        border: none;
      }

      .table-custom tbody tr {
        background: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .table-custom tbody td {
        padding: 15px;
        border: none;
      }

      .badge-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .badge-success {
        background: #d4edda;
        color: #27ae60;
      }

      .badge-warning {
        background: #fff3cd;
        color: #f39c12;
      }

      .badge-danger {
        background: #f8d7da;
        color: #e74c3c;
      }

      /* Buttons */
      .btn-custom {
        padding: 12px 25px;
        border-radius: 10px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary-custom {
        background: linear-gradient(135deg, #3498db, #2ecc71);
        color: white;
      }

      .btn-primary-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
      }

      .btn-danger-custom {
        background: #e74c3c;
        color: white;
      }

      .btn-secondary-custom {
        background: #95a5a6;
        color: white;
      }

      /* Loader */
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none !important;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .main-content {
          margin-left: 0;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="bi bi-shield-lock-fill"></i>
          <span>PERC Admin</span>
        </div>
      </div>

      <ul class="sidebar-menu">
        <li>
          <a href="#" class="active" onclick="showSection('dashboard')">
            <i class="bi bi-speedometer2"></i>
            <span>Tableau de bord</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="showSection('import')">
            <i class="bi bi-cloud-upload"></i>
            <span>Import CGF</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="showSection('history')">
            <i class="bi bi-clock-history"></i>
            <span>Historique</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="showSection('participants')">
            <i class="bi bi-people"></i>
            <span>Participants</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="showSection('stats')">
            <i class="bi bi-bar-chart"></i>
            <span>Statistiques</span>
          </a>
        </li>
      </ul>

      <div
        style="position: absolute; bottom: 20px; width: 100%; padding: 0 20px"
      >
        <hr style="border-color: rgba(255, 255, 255, 0.2)" />
        <a
          href="#"
          onclick="logout()"
          style="
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
          "
        >
          <i class="bi bi-box-arrow-right"></i>
          <span>Déconnexion</span>
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Navbar -->
      <div class="navbar-custom">
        <div class="navbar-title">
          <h4 id="pageTitle">Tableau de bord</h4>
        </div>
        <div class="navbar-user">
          <div class="user-info">
            <p class="user-name" id="adminName">Administrateur</p>
            <p class="user-role">Gestionnaire PERC</p>
          </div>
          <button class="btn btn-danger btn-sm" onclick="logout()">
            <i class="bi bi-box-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- SECTION: Dashboard -->
      <div id="sectionDashboard">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card primary">
            <div class="stat-icon">
              <i class="bi bi-people-fill"></i>
            </div>
            <div class="stat-value" id="statParticipants">0</div>
            <div class="stat-label">Participants actifs</div>
          </div>

          <div class="stat-card success">
            <div class="stat-icon">
              <i class="bi bi-cash-stack"></i>
            </div>
            <div class="stat-value" id="statSolde">0 F CFA</div>
            <div class="stat-label">Solde total système</div>
          </div>

          <div class="stat-card warning">
            <div class="stat-icon">
              <i class="bi bi-calendar-check"></i>
            </div>
            <div class="stat-value" id="statContributions">0</div>
            <div class="stat-label">Contributions ce mois</div>
          </div>

          <div class="stat-card danger">
            <div class="stat-icon">
              <i class="bi bi-cloud-upload"></i>
            </div>
            <div class="stat-value" id="statImports">0</div>
            <div class="stat-label">Imports effectués</div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card-custom">
          <h5 class="card-title">Activité récente</h5>
          <p class="text-muted">Dernières opérations système</p>
          <div id="recentActivity">
            <div class="spinner"></div>
          </div>
        </div>
      </div>

      <!-- SECTION: Import CGF -->
      <div id="sectionImport" class="hidden">
        <div class="card-custom">
          <h5 class="card-title">
            <i class="bi bi-cloud-upload"></i> Import Fichier CGF
          </h5>
          <p class="text-muted">
            Importer les contributions depuis un fichier Excel ou CSV
          </p>

          <!-- Upload Zone -->
          <div
            id="uploadZone"
            class="upload-zone"
            onclick="document.getElementById('fileInput').click()"
          >
            <div class="upload-icon">
              <i class="bi bi-cloud-arrow-up"></i>
            </div>
            <div class="upload-text">Glissez votre fichier ici</div>
            <div class="upload-hint">
              ou cliquez pour sélectionner (Excel/CSV, max 10 MB)
            </div>
            <input
              type="file"
              id="fileInput"
              accept=".xlsx,.xls,.csv"
              style="display: none"
              onchange="handleFileSelect(event)"
            />
          </div>

          <!-- File Info -->
          <div id="fileInfo" class="hidden" style="margin-top: 20px">
            <div class="alert alert-info">
              <i class="bi bi-file-earmark-spreadsheet"></i>
              <strong id="fileName"></strong> (<span id="fileSize"></span>)
            </div>
            <button
              class="btn-custom btn-primary-custom"
              onclick="uploadFile()"
            >
              <i class="bi bi-upload"></i> Lancer l'import
            </button>
            <button
              class="btn-custom btn-secondary-custom ms-2"
              onclick="cancelUpload()"
            >
              Annuler
            </button>
          </div>

          <!-- Progress -->
          <div id="uploadProgress" class="hidden">
            <h6>Import en cours...</h6>
            <div class="progress-custom">
              <div
                class="progress-bar-custom"
                id="progressBar"
                style="width: 0%"
              >
                0%
              </div>
            </div>
          </div>

          <!-- Results -->
          <div id="importResults" class="hidden">
            <h5>Résultats de l'import</h5>
            <div class="result-box">
              <div class="result-stats">
                <div class="result-stat">
                  <h3 id="totalLines">0</h3>
                  <p>Lignes traitées</p>
                </div>
                <div class="result-stat success">
                  <h3 id="successCount">0</h3>
                  <p>Succès</p>
                </div>
                <div class="result-stat error">
                  <h3 id="errorCount">0</h3>
                  <p>Erreurs</p>
                </div>
              </div>
            </div>
            <div id="errorDetails"></div>
            <button
              class="btn-custom btn-primary-custom mt-3"
              onclick="resetImport()"
            >
              <i class="bi bi-arrow-repeat"></i> Nouvel import
            </button>
          </div>
        </div>

        <!-- Format Info -->
        <div class="card-custom mt-4">
          <h5 class="card-title">
            <i class="bi bi-info-circle"></i> Format du fichier
          </h5>
          <p class="text-muted">
            Le fichier Excel doit contenir les colonnes suivantes :
          </p>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Matricule</th>
                  <th>Compte N°</th>
                  <th>Nom</th>
                  <th>Direction</th>
                  <th>E-mail</th>
                  <th>Tél.</th>
                  <th>Montant Versé</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>508924B</td>
                  <td>0182000401</td>
                  <td>M. EXEMPLE</td>
                  <td>DOD/DRDP/...</td>
                  <td>email@example.com</td>
                  <td>77 XXX XX XX</td>
                  <td>1 562 955</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SECTION: History -->
      <div id="sectionHistory" class="hidden">
        <div class="card-custom">
          <h5 class="card-title">
            <i class="bi bi-clock-history"></i> Historique des imports
          </h5>
          <div id="historyList">
            <div class="spinner"></div>
          </div>
        </div>
      </div>

      <!-- SECTION: Participants -->
      <div id="sectionParticipants" class="hidden">
        <div class="card-custom">
          <h5 class="card-title">
            <i class="bi bi-people"></i> Liste des participants
          </h5>
          <div class="mb-3">
            <input
              type="text"
              class="form-control"
              id="searchInput"
              placeholder="Rechercher par matricule ou nom..."
            />
          </div>
          <div id="participantsList">
            <div class="spinner"></div>
          </div>
        </div>
      </div>

      <!-- SECTION: Stats -->
      <div id="sectionStats" class="hidden">
        <div class="card-custom">
          <h5 class="card-title">
            <i class="bi bi-bar-chart"></i> Statistiques détaillées
          </h5>
          <p class="text-muted">Analyses et rapports du système PERC</p>
          <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Section en cours de développement
          </div>
        </div>
      </div>
    </div>
    <script>
      const API_BASE = "http://localhost:3000/api";
      const token = localStorage.getItem("percAdminToken");
      let selectedFile = null;

      // Vérifier auth au chargement
      if (!token) {
        window.location.href = "admin-login.html";
      }

      // Charger les infos admin
      const adminData = JSON.parse(localStorage.getItem("percAdmin") || "{}");
      if (adminData.nom_complet) {
        document.getElementById("adminName").textContent =
          adminData.nom_complet;
      }

      // Navigation
      function showSection(section) {
        // Cacher toutes les sections
        ["Dashboard", "Import", "History", "Participants", "Stats"].forEach(
          (s) => {
            document.getElementById("section" + s).classList.add("hidden");
          }
        );

        // Afficher la section demandée
        const sectionElement = document.getElementById(
          "section" + section.charAt(0).toUpperCase() + section.slice(1)
        );
        sectionElement.classList.remove("hidden");

        // Mettre à jour le menu actif
        document
          .querySelectorAll(".sidebar-menu a")
          .forEach((a) => a.classList.remove("active"));
        event.target.closest("a").classList.add("active");

        // Mettre à jour le titre
        const titles = {
          dashboard: "Tableau de bord",
          import: "Import CGF",
          history: "Historique des imports",
          participants: "Participants",
          stats: "Statistiques",
        };
        document.getElementById("pageTitle").textContent = titles[section];

        // Charger les données si nécessaire
        if (section === "dashboard") loadDashboard();
        if (section === "history") loadHistory();
        if (section === "participants") loadParticipants();
      }

      // Charger dashboard
      async function loadDashboard() {
        try {
          // Simuler le chargement des stats (à remplacer par vraies API calls)
          document.getElementById("statParticipants").textContent = "125";
          document.getElementById("statSolde").textContent =
            "156 500 000 F CFA";
          document.getElementById("statContributions").textContent = "89";
          document.getElementById("statImports").textContent = "12";

          document.getElementById("recentActivity").innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> Import réussi - 45 contributions ajoutées (Il y a 2 heures)
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-person-plus"></i> Nouveau participant ajouté: M. DIALLO (Il y a 5 heures)
                    </div>
                `;
        } catch (error) {
          console.error("Erreur chargement dashboard:", error);
        }
      }

      // Drag & Drop
      const uploadZone = document.getElementById("uploadZone");

      uploadZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadZone.classList.add("dragover");
      });

      uploadZone.addEventListener("dragleave", () => {
        uploadZone.classList.remove("dragover");
      });

      uploadZone.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadZone.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      });

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) handleFile(file);
      }

      function handleFile(file) {
        const validExts = [".xlsx", ".xls", ".csv"];
        const fileExt = file.name
          .substring(file.name.lastIndexOf("."))
          .toLowerCase();

        if (!validExts.includes(fileExt)) {
          alert("Format non supporté. Utilisez .xlsx, .xls ou .csv");
          return;
        }

        if (file.size > 10 * 1024 * 1024) {
          alert("Fichier trop volumineux. Maximum 10 MB");
          return;
        }

        selectedFile = file;
        document.getElementById("fileName").textContent = file.name;
        document.getElementById("fileSize").textContent = formatFileSize(
          file.size
        );
        document.getElementById("uploadZone").classList.add("hidden");
        document.getElementById("fileInfo").classList.remove("hidden");
      }

      function cancelUpload() {
        selectedFile = null;
        document.getElementById("fileInput").value = "";
        document.getElementById("uploadZone").classList.remove("hidden");
        document.getElementById("fileInfo").classList.add("hidden");
      }

      async function uploadFile() {
        if (!selectedFile) return;

        document.getElementById("fileInfo").classList.add("hidden");
        document.getElementById("uploadProgress").classList.remove("hidden");

        const formData = new FormData();
        formData.append("file", selectedFile);

        try {
          // Simuler progression
          let progress = 0;
          const interval = setInterval(() => {
            progress += 10;
            if (progress <= 90) {
              document.getElementById("progressBar").style.width =
                progress + "%";
              document.getElementById("progressBar").textContent =
                progress + "%";
            }
          }, 200);

          const response = await fetch(`${API_BASE}/import/cgf`, {
            method: "POST",
            headers: { Authorization: `Bearer ${token}` },
            body: formData,
          });

          clearInterval(interval);
          document.getElementById("progressBar").style.width = "100%";
          document.getElementById("progressBar").textContent = "100%";

          const result = await response.json();

          setTimeout(() => {
            document.getElementById("uploadProgress").classList.add("hidden");
            displayResults(result);
          }, 500);
        } catch (error) {
          console.error("Erreur upload:", error);
          alert("Erreur lors de l'import");
          document.getElementById("uploadProgress").classList.add("hidden");
          cancelUpload();
        }
      }

      function displayResults(result) {
        if (!result.success) {
          alert("Erreur: " + result.message);
          cancelUpload();
          return;
        }

        const data = result.data;
        document.getElementById("totalLines").textContent = data.total_lignes;
        document.getElementById("successCount").textContent = data.succes;
        document.getElementById("errorCount").textContent = data.erreurs;

        // Afficher les erreurs
        const errorDiv = document.getElementById("errorDetails");
        errorDiv.innerHTML = "";

        if (data.erreurs > 0) {
          const errors = data.details.filter((d) => d.statut === "ERREUR");
          errorDiv.innerHTML =
            '<h6 class="text-warning mt-3">Détails des erreurs :</h6>';

          errors.forEach((err) => {
            errorDiv.innerHTML += `
                        <div class="alert alert-warning">
                            <strong>Ligne ${err.ligne}</strong> - Matricule: ${err.matricule}<br>
                            <small>${err.erreur}</small>
                        </div>
                    `;
          });
        }

        document.getElementById("importResults").classList.remove("hidden");
      }

      function resetImport() {
        selectedFile = null;
        document.getElementById("fileInput").value = "";
        document.getElementById("importResults").classList.add("hidden");
        document.getElementById("uploadZone").classList.remove("hidden");
      }

      async function loadHistory() {
        document.getElementById("historyList").innerHTML =
          '<div class="spinner"></div>';

        try {
          const response = await fetch(`${API_BASE}/import/history`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          const result = await response.json();

          if (result.success && result.data.length > 0) {
            let html =
              '<table class="table-custom"><thead><tr><th>Date</th><th>Fichier</th><th>Lignes</th><th>Succès</th><th>Erreurs</th><th>Statut</th></tr></thead><tbody>';

            result.data.forEach((imp) => {
              html += `
                            <tr>
                                <td>${new Date(imp.date_import).toLocaleString(
                                  "fr-FR"
                                )}</td>
                                <td>${imp.nom_fichier}</td>
                                <td>${imp.nombre_lignes}</td>
                                <td class="text-success">${
                                  imp.nombre_succes
                                }</td>
                                <td class="text-warning">${
                                  imp.nombre_erreurs
                                }</td>
                                <td><span class="badge-status ${
                                  imp.statut === "complet"
                                    ? "badge-success"
                                    : "badge-warning"
                                }">${imp.statut}</span></td>
                            </tr>
                        `;
            });

            html += "</tbody></table>";
            document.getElementById("historyList").innerHTML = html;
          } else {
            document.getElementById("historyList").innerHTML =
              '<p class="text-muted">Aucun import enregistré</p>';
          }
        } catch (error) {
          console.error("Erreur chargement historique:", error);
          document.getElementById("historyList").innerHTML =
            '<p class="text-danger">Erreur de chargement</p>';
        }
      }

      async function loadParticipants() {
        document.getElementById("participantsList").innerHTML =
          '<div class="spinner"></div>';
        // Simuler des données (à remplacer par vraie API)
        setTimeout(() => {
          document.getElementById("participantsList").innerHTML = `
                    <table class="table-custom">
                        <thead><tr><th>Matricule</th><th>Nom</th><th>Compte CGF</th><th>Solde</th></tr></thead>
                        <tbody>
                            <tr><td>508924B</td><td>M. ABABACAR DIOP</td><td>0182000401</td><td>1 562 955 F CFA</td></tr>
                            <tr><td>679594H</td><td>M. ABABACAR SADIKH BA</td><td>0224970401</td><td>700 096 F CFA</td></tr>
                        </tbody>
                    </table>
                `;
        }, 500);
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + " KB";
        return (bytes / (1024 * 1024)).toFixed(2) + " MB";
      }

      function logout() {
        if (confirm("Voulez-vous vraiment vous déconnecter ?")) {
          localStorage.removeItem("percAdminToken");
          localStorage.removeItem("percUserType");
          localStorage.removeItem("percAdmin");
          window.location.href = "admin-login.html";
        }
      }

      // Charger le dashboard au démarrage
      loadDashboard();
    </script>
  </body>
</html>
